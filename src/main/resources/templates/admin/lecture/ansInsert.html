<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>강좌상세</title>
    <th:block th:replace="/include/adminhead :: head"></th:block>
    <!-- video.js api 가져오기 -->
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />
    <style>
        /* video.js 에서 본시간/총시간 식으로 보이게 하는 css */
        .video-js .vjs-time-control{display:block;}
        .video-js .vjs-remaining-time{display: none;}
    </style>
</head>
<body>
<div class="container-scroller">
    <div class="container-fluid page-body-wrapper">
        <th:block th:replace="/include/adminheader :: header"></th:block>

        <div class="main-panel">
            <div class="content-wrapper">
                <h1>관리자페이지</h1>
                <h2>답변 등록</h2>
                <hr style="border-top: 1px solid #333">
                <div class="card p-3">
                    <div style="width: 700px; float: left">
                        <h3>비디오</h3>
                        <video
                                id="my-video"
                                class="video-js"
                                controls
                                preload="auto"
                                width="640"
                                height="360"
                                data-setup="{}"
                        >
                            <source th:src="@{/upload/} + ${savefile}" type="video/mp4" />
                            <p class="vjs-no-js">
                                To view this video please enable JavaScript, and consider upgrading to a
                                web browser that
                                <a href="https://videojs.com/html5-video-support/" target="_blank">
                                    supports HTML5 video
                                </a>
                            </p>
                        </video>
                    </div>

                    <div style="width: 400px; float: left">
                        <h3>질문한 위치</h3>
                        <div id="time"></div>
                        <h3>질문 내용</h3>
                        <div th:text="${dto.que}"></div>
                        <br>
                        <hr>
                        <br>

                        <div>
                            <h3>답변 등록</h3>
                            <form th:action="@{/admin/ansInsert}" method="post" onsubmit="return answerCheck();">
                                <div>
                                    <input type="hidden" name="no" id="no" th:value="${dto.no}">
                                    <input type="text" name="ans" id="ans" maxlength="1000" required>
                                </div>
                                <div>
                                    <span id="warn"></span>
                                </div>

                                <div>
                                    <input type="submit" class="btn btn-primary" value="입력">
                                    <input type="reset" class="btn btn-danger" value="초기화">
                                </div>
                            </form>
                        </div>
                    </div>

                    <footer class="footer">
                        <div class="d-sm-flex justify-content-center justify-content-sm-between">
                            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2021.  Premium <a href="https://www.bootstrapdash.com/" target="_blank">Bootstrap admin template</a> from BootstrapDash. All rights reserved.</span>
                            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Hand-crafted & made with <i class="ti-heart text-danger ml-1"></i></span>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    /*<![CDATA[*/
    let video = document.getElementById('my-video');
    let page = [[${dto.page}]];                 // 현재 듣는 강의 페이지
    let sec = [[${dto.sec}]];                   // db에 저장된 해당 이용자가 본 시간

    console.log('page : ' + page);
    console.log('sec : ' + sec);

    $(document).ready(() => {

        video.currentTime = sec;

        if (sec > 0) {
            // 비디오가 로드 되었을 때
            video.addEventListener('loadedmetadata', function() {
                // 시간 구하기
                const hours = Math.floor(sec / 3600); // 시간
                const minutes = Math.floor((sec % 3600) / 60); // 분
                const seconds = Math.floor(sec % 60); // 초
                $("#time").text(`질문한 시간 위치: ${hours} 시간  ${minutes} 분  ${seconds} 초`);
            });
        } else {
            $("#time").text(`질문한 시간 위치: 0 시간  0 분  0 초`);
        }
    });

    // 답변하기
    function answerCheck() {
        console.log('답변 버튼 클릭');

        let value = $("#ans").val();
        console.log(value);
        if(value === "") {
            $("#warn").html("질문을 입력하세요.") // error 문구
            return false;
        }

        // 패턴 비교 한글, 자음, 모음, 영어대소문자, 숫자, 공백, 엔터, 1~200 자리
        let pattern = /^[가-힣ㄱ-ㅎㅏ-ㅣa-zA-Z0-9\s\n]{1,200}$/;
        if (!pattern.test(value)) {
            $("#warn").html("한글, 영어대소문자, 숫자만 입력이 가능합니다. <br>최대 200자까지 입력 가능합니다."); // error 문구
            return false;
        }

        return true;
    }
</script>
<script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
</body>
</html>